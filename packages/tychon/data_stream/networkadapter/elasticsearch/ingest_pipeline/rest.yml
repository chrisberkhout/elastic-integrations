---
description: Pipeline for parsing TYCHON Network Adapters
processors:

  - remove:
      field: tychon.host.adapter.ip
      if: ctx.tychon.host.adapter.ip == ''
  - remove:
      field: tychon.host.adapter.gateway
      if: ctx.tychon.host.adapter.gateway == ''
  - remove:
      field: tychon.host.adapter.dhcp.server
      if: ctx.tychon.host.adapter.dhcp.server == ''
  - remove:
      field: tychon.host.adapter.dhcp.lease_obtained
      if: ctx.tychon.host.adapter.dhcp.lease_obtained == ''
  - remove:
      field: tychon.host.adapter.dhcp.lease_expires
      if: ctx.tychon.host.adapter.dhcp.lease_expires == ''
  - remove:
      field: tychon.host.adapter.driver.date
      if: ctx.tychon.host.adapter.driver.date == ''
  - remove:
      field: tychon.host.adapter.wins_server
      if: ctx.tychon.host.adapter.wins_server == ''

  - script:
      source: |
        if (ctx.tychon?.host?.adapter?.link_speed?.contains(' ') == true) {
          String[] parts = ctx.tychon.host.adapter.link_speed.splitOnToken(' ');
          ctx.tychon.host.adapter.link_speed = Long.parseLong(parts[0]);
          if (parts[1] == 'Kbps') {
            ctx.tychon.host.adapter.link_speed *= 1024
          } else if (parts[1] == 'Mbps') {
            ctx.tychon.host.adapter.link_speed *= 1024*1024
          } else if (parts[1] == 'Gbps') {
            ctx.tychon.host.adapter.link_speed *= 1024*1024*1024
          }
        } else {
          if (ctx.tychon.host == null) {
            ctx.tychon.host = [:];
          }
          if (ctx.tychon.host.adapter == null) {
            ctx.tychon.host.adapter = [:];
          }
          ctx.tychon.host.adapter.link_speed = 0L;
        }

  # ECS fields

  - set:
      field: event.kind
      value: state
  - set:
      field: event.category
      value: [configuration]
  - set:
      field: event.type
      value: [info]
