---
description: Pipeline for TYCHON Features Datasets
processors:

  - remove:
      field: tychon.error.message
      if: ctx.tychon.error.message == ""
      ignore_missing: true
  - remove:
      field: tychon.file.created
      if: ctx.tychon.file.created == ''
      ignore_failure: true
      ignore_missing: true
  - remove:
      field: tychon.file.accessed
      if: ctx.tychon.file.accessed == ''
      ignore_failure: true
      ignore_missing: true
  - remove:
      field: tychon.file.mtime
      if: ctx.tychon.file.mtime == ''
      ignore_failure: true
      ignore_missing: true
  - script:
      lang: painless
      description: Remove non-strings from file.attributes
      if: ctx.tychon?.file?.attributes instanceof List
      source: |
        def result = [];
        for (def v : ctx.tychon.file.attributes) {
          if (v instanceof String) {
            result.add(v);
          }
        }
        ctx.tychon.file.attributes = result;
  - convert:
      field: tychon.file.size
      type: long
      ignore_missing: true
  - convert:
      field: tychon.server.port
      type: long
      ignore_missing: true
  - rename:
      field: tychon.process.owner
      target_field: tychon.process.user.name
      ignore_missing: true
  - convert:
      field: tychon.process.pid
      type: long
      ignore_missing: true
  - rename:
      field: tychon.process.ppid
      target_field: tychon.process.parent.pid
      ignore_missing: true
  - convert:
      field: tychon.process.parent.pid
      type: long
      ignore_missing: true
  - rename:
      field: tychon.file.code_signature.issuer
      target_field: tychon.file.x509.issuer.distinguished_name
      ignore_missing: true
  - rename:
      field: tychon.tls.server.supported_cipher.name
      target_field: tychon.tls.server.supported_ciphers
      ignore_missing: true
  - rename:
      field: tychon.tls.server.supported_cipher.mac
      target_field: tychon.tls.server.supported_cipher_mac
      ignore_missing: true
  - split:
      field: tychon.tls.client.supported_ciphers
      separator: ","
      ignore_missing: true
      ignore_failure: true

  # ECS fields

  - set:
      field: event.category
      value: [configuration]