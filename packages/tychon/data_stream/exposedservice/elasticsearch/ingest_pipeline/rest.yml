---
description: Pipeline for Exposed Services
processors:

  - convert:
      field: tychon.process.pid
      type: long
      ignore_missing: true
  - convert:
      field: tychon.source.port
      type: long
      ignore_missing: true
  - set:
      field: tychon.source.ip
      value: '0.0.0.0'
      if: ctx.tychon.source?.ip == ''
  - set:
      field: tychon.service.name
      value: '{{tychon.process.name}}'
      if: "ctx.tychon.service?.name == null"

  # ECS fields

  - set:
      field: event.category
      value: [network]

  # ECS fields from the tychon fieldset

  - set:
      field: network.transport
      copy_from: tychon.network.transport
      ignore_empty_value: true
  - set:
      field: process.command_line
      copy_from: tychon.process.command_line
      ignore_empty_value: true
  - set:
      field: process.executable
      copy_from: tychon.process.executable
      ignore_empty_value: true
  - set:
      field: process.hash.sha1
      copy_from: tychon.process.hash.sha1
      ignore_empty_value: true
  - set:
      field: process.name
      copy_from: tychon.process.name
      ignore_empty_value: true
  - set:
      field: process.pid
      copy_from: tychon.process.pid
      ignore_empty_value: true
  - set:
      field: process.start
      copy_from: tychon.process.start
      ignore_empty_value: true
  - set:
      field: process.user.name
      copy_from: tychon.process.user.name
      ignore_empty_value: true
  - set:
      field: service.name
      copy_from: tychon.service.name
      ignore_empty_value: true
  - set:
      field: service.state
      copy_from: tychon.service.state
      ignore_empty_value: true
  - set:
      field: source.ip
      copy_from: tychon.source.ip
      ignore_empty_value: true
  - set:
      field: source.port
      copy_from: tychon.source.port
      ignore_empty_value: true
